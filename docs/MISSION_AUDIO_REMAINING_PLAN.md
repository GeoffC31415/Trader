# Mission Audio — Remaining Work Plan

This document is a short handoff plan for generating the **remaining mission voice audio** (MP3s) and updating the mission audio manifest.

## Current state (as of 2026-01-04)

- **Mission dialogue export** lives at `docs/mission_dialogue_export.json` (generated by `scripts/export_mission_dialogue.mjs`).
- **Generated audio + manifest** live at:
  - `public/audio/missions/**` (MP3s)
  - `public/audio/missions/manifest.json` (what the UI uses to decide if audio exists)
- **Arc 3 (Energy Monopoly)** dialogue is implemented and exported (stages 1–4, both paths), but only Stage 1 may have audio depending on what’s been generated so far.

## Ground rules

- Run these commands from your usual environment (Windows / WSL setup). The scripts are Node-based:
  - Export: `node scripts/export_mission_dialogue.mjs`
  - Generate: `node scripts/generate_mission_voices.mjs ...`
- **Do not edit** `public/audio/missions/manifest.json` manually — it’s generated by `scripts/generate_mission_voices.mjs`.

## Step 0 — Confirm what’s missing (fast)

1. Check which missions have audio:
   - Open `public/audio/missions/manifest.json` and look under `"missions"`.
2. Check which missions are export-ready:
   - Open `docs/mission_dialogue_export.json` and look under `"missions"`.

Any mission in export but not in manifest = **ready to generate**.

## Step 1 — Generate remaining Arc 3 audio (export-ready)

These Arc 3 missions should exist in `docs/mission_dialogue_export.json`:

- `energy_monopoly_stage_2`
- `energy_monopoly_stage_3_refinery`
- `energy_monopoly_stage_3_ceres`
- `energy_monopoly_stage_4_refinery`
- `energy_monopoly_stage_4_ceres`

Preview each mission (no API calls):

```bash
node scripts/generate_mission_voices.mjs --preview --mission energy_monopoly_stage_2
node scripts/generate_mission_voices.mjs --preview --mission energy_monopoly_stage_3_refinery
node scripts/generate_mission_voices.mjs --preview --mission energy_monopoly_stage_3_ceres
node scripts/generate_mission_voices.mjs --preview --mission energy_monopoly_stage_4_refinery
node scripts/generate_mission_voices.mjs --preview --mission energy_monopoly_stage_4_ceres
```

Generate MP3s (requires `ELEVENLABS_API_KEY` configured):

```bash
node scripts/generate_mission_voices.mjs --mission energy_monopoly_stage_2
node scripts/generate_mission_voices.mjs --mission energy_monopoly_stage_3_refinery
node scripts/generate_mission_voices.mjs --mission energy_monopoly_stage_3_ceres
node scripts/generate_mission_voices.mjs --mission energy_monopoly_stage_4_refinery
node scripts/generate_mission_voices.mjs --mission energy_monopoly_stage_4_ceres
```

Notes:
- Each run regenerates `public/audio/missions/manifest.json` at the end.
- Use `--force` if you want to regenerate existing files.

## Step 2 — Dialogue still missing for other arcs (prereq before audio)

If you want to fully complete mission audio for the whole story system, the following missions still need **dialogue definitions added to the export pipeline** (and ideally also to the in-game dialogue file) before any audio can be generated.

### Missing dialogue (from templates; update as you complete)

- **Arc 1**
  - `sol_city_stage_4`

- **Arc 2**
  - `fabrication_wars_stage_2_aurum`
  - `fabrication_wars_stage_2_drydock`
  - `fabrication_wars_stage_3` (if still used)
  - `fabrication_wars_stage_3_aurum`
  - `fabrication_wars_stage_3_drydock`
  - `fabrication_wars_stage_4_aurum`
  - `fabrication_wars_stage_4_drydock`

- **Arc 4**
  - `pirate_accords_stage_2`
  - `pirate_accords_stage_3_pirate`
  - `pirate_accords_stage_3_law`
  - `pirate_accords_stage_3_peace`

- **Arc 5**
  - `union_crisis_stage_2`
  - `union_crisis_stage_3_union`
  - `union_crisis_stage_3_corporate`

### Recommended workflow for each “missing dialogue” batch

1. Add dialogue entries to:
   - `src/systems/missions/mission_dialogue.ts` (in-game)
   - `scripts/export_mission_dialogue.mjs` (voice export mirror)
2. Re-export:

```bash
node scripts/export_mission_dialogue.mjs
```

3. Preview generation for the new mission(s):

```bash
node scripts/generate_mission_voices.mjs --preview --mission <mission_id>
```

4. Generate the MP3s:

```bash
node scripts/generate_mission_voices.mjs --mission <mission_id>
```

## Step 3 — Verification checklist (done criteria)

- `docs/mission_dialogue_export.json` contains the mission ID(s).
- `public/audio/missions/<stationId>/<missionId>/` contains MP3 files for:
  - `_intro_#` lines (for LISTEN / intro playback)
  - `_accept` line (optional playback)
  - key moment IDs (optional)
  - `_complete_#` lines (optional)
- `public/audio/missions/manifest.json` includes the mission ID under `"missions"`.
- In-game: the **LISTEN / REPLAY** button plays for that mission.


